<!DOCTYPE html>
<html>
<head>
<title>Students</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<link rel="stylesheet" href="{{ url_for('static', filename='ui.css') }}">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>
<body>

<!-- ================= SIDEBAR ================= -->
<div class="sidebar">
    <h4>âš¡ {{ role|capitalize }}</h4>

    <a href="/dashboard">
        <i class="bi bi-speedometer2"></i>
        <span>Dashboard</span>
    </a>

    <a href="/" class="active">
        <i class="bi bi-people-fill"></i>
        <span>Students</span>
    </a>

    <a href="/logout">
        <i class="bi bi-box-arrow-right"></i>
        <span>Logout</span>
    </a>
</div>

<!-- ================= MAIN CONTENT ================= -->
<div class="content">

<div class="glass-card">

<h2 class="mb-4 text-center">ðŸŽ“ Student Management</h2>

<!-- ================= ADD FORM ================= -->
<form method="POST" action="/add">
    <input name="name" class="form-control mb-3" placeholder="Name" required>
    <input name="age" type="number" class="form-control mb-3" placeholder="Age" required>
    <input name="course" class="form-control mb-3" placeholder="Course" required>
    <button class="btn btn-success btn-modern">Add Student</button>
</form>

<!-- ================= TABLE ================= -->
<div class="table-responsive mt-4">
<table class="table table-modern text-center align-middle">

<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th>Age</th>
<th>Course</th>
<th>Action</th>
</tr>
</thead>

<tbody>
{% for s in students %}
<tr>
<td>{{ s[0] }}</td>
<td>{{ s[1] }}</td>
<td>{{ s[2] }}</td>
<td>{{ s[3] }}</td>
<td>

<!-- EDIT (Both Admin & Staff) -->
<a href="/edit/{{ s[0] }}" class="btn btn-warning btn-sm">
<i class="bi bi-pencil-square"></i>
</a>

<!-- DELETE (Only Admin) -->
{% if role == 'admin' %}
<button onclick="confirmDelete({{ s[0] }})"
        class="btn btn-danger btn-sm">
<i class="bi bi-trash"></i>
</button>
{% endif %}

</td>
</tr>
{% endfor %}
</tbody>

</table>
</div>

</div>
</div>

<!-- ================= POPUPS ================= -->

<script>
const urlParams = new URLSearchParams(window.location.search);

if (urlParams.get("added")) {
    Swal.fire({
        icon: "success",
        title: "Student Added Successfully!",
        timer: 1500,
        showConfirmButton: false
    });
}

if (urlParams.get("updated")) {
    Swal.fire({
        icon: "success",
        title: "Student Updated Successfully!",
        timer: 1500,
        showConfirmButton: false
    });
}

if (urlParams.get("deleted")) {
    Swal.fire({
        icon: "success",
        title: "Student Deleted Successfully!",
        timer: 1500,
        showConfirmButton: false
    });
}

function confirmDelete(id) {
    Swal.fire({
        title: "Delete Student?",
        text: "This action cannot be undone!",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#d33",
        confirmButtonText: "Yes, Delete"
    }).then((result) => {
        if (result.isConfirmed) {
            window.location.href = "/delete/" + id;
        }
    });
}
</script>

</body>
</html>